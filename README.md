# Artemis / Metrc Integration

Artemis' integration service for [Metrc](https://api-co.metrc.com/Documentation/).

Things you may want to cover:
* Ruby version: `v2.6.5`

* System dependencies:

  * Docker.
  * docker-compose
  * Ruby v2.6.5
  * bundler v2.
  * If you use Mac, and don't wish to install Postgres locally, run `bundle config --local build.pg --with-opt-dir="/usr/local/opt/libpq"` on your shell.

* Database creation: docker compose takes care of creating the database and performing migrations for you.

* How to run the test suite: `bundle exec rake test` or `bundle exec guard`.

* Services: the application uses Sidekiw, along with Redis, in order to run background jobs. Locally, docker-compose takes care of creating and running these instances for you.

* Deployment instructions: push to master, and let the Heroku integration do it for you.

* How to start: simply run `docker-compose up --build` and grab a cup a coffee.

## Metrc state-endpoint payloads

| Op. | Endpoint | MD | OH | MA | CO | OR | MT |
|-----|----------|----|----|----|----|----|----|
| Seed | `POST /plantbatches/v1/createplantings` | <sub><sup>`[{"Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> | <sub><sup>`[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> |<sub><sup> `[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> | <sub><sup>`[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> | <sub><sup>`[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> | <sub><sup>`[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> | <sub><sup>`[{ "Name": <tracking-code>, "Type": <seeding-unit-name>, "Count": <batch-quantity>, "Strain": <batch-crop-variety>, "Room": <batch-zone-name>, "PatientLicenseNumber": null, "ActualDate": <batch-seeded_at> }]`</sup></sub> |
| Move (PB) | `PUT /plantbatches/v1/moveplantbatches` | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Room": <completion-zone-name>, "MoveDate": <completion-start_time> }]`</sup></sub> |
| Move (CGP) | `POST /plantbatches/v1/changegrowthphase` | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> | <sub><sup>`[{ "Name": <batch-arbitrary-id>, "Count": <batch-quantity>, "StartingTag": <first-item-barcode-id>, "GrowthPhase": <seeding-unit-name>, "NewRoom": <batch-zone-name>, "GrowthDate": <completion-start_time>, "PatientLicenseNumber": null }]`</sup></sub> |
| Move (MP) | `POST /plants/v1/moveplants` | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "Room": <completion-zone-name>, "ActualDate": <completion-start_time> }]`</sup></sub> |
| Discard (immature) | `POST /plantbatches/v1/destroy` | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "PlantBatch": <batch-arbitrary-id>, "Count": <discard-quantity>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> |
| Discard (mature/partial) | `POST /plants/v1/destroyplants` | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <completion-barcode>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> |
| Discard (mature/complete) | `POST /plants/v1/destroyplants` | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> | <sub><sup>`[{ "Id": null, "Label": <item-barcode-id>, "ReasonNote": <discard-reason>, "ActualDate": <discard-discarded_at> }]`</sup></sub> |
| Harvest (manicure) | `POST /plants/v1/manicureplants`  | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": null }]`</sup></sub> |
| Harvest (complete) | `POST /plants/v1/harvestplants` | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> | <sub><sup>`[{ "DryingRoom": <completion-zone_name>, "PatientLicenseNumber": null, "ActualDate": <completion-start_time>, "Plant": <item-barcode-id>, "Weight": <items-average-weight>, "UnitOfWeight": <item-secondary_harvest_unit>, "HarvestName": <batch-arbitrary-id> }]`</sup></sub> |

